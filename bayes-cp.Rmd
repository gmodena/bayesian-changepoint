---
title: "Bayesian changepoint analisys"
author: "Gabriele Modena"
date: "31 July 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



Global seed
```{r}
set.seed(42)
```

Generate some data
```{r}
x1 <- rnorm(40, mean=15, sd=0.5)
x2 <- rnorm(80, mean=18, sd=0.5)

x <- c(x1, x2)
plot(x, type='l')
```

# Changepoint

...


We can write this as $P(D | \hat{\Theta})$, where for a Gaussian the parameters  $\hat{\Theta} = (\mu, \sigma)$. When a changepoint occurs at time $\tau$, we have $P(D_{1,\tau} | \hat{\Theta_1}) + P(D_{{\tau+1}, n} | \hat{\Theta_2})$. To determine whether a change of parameters is significant, the frequentist approach would be
to frame the problem as a likelihood test and generate a test statistic.

With Basyesian approach instead we will first stick some priors the the parameters, and then sample from the posterior $P(\tau,D |\hat{Theta_1}, \hat{Theta_2})$ to obtain en estimate of the most probable changepoint \tau.

## Changepoint detection as a likelhood test
To determine whether a change of parameters is significant, the frequentist approach would be
to frame the problem as a likelihood test. 

I will not implement an algorithm for this, but rather rely on the excellent [changepoint](https://www.google.nl/search?client=safari&rls=en&q=changepoint+rstats&ie=UTF-8&oe=UTF-8&gfe_rd=cr&ei=8mWeV9m9JYT5-gbC-4Bo) package.

```{r}
library(changepoint)

plot(cpt.mean(x))
```

Whereas is we look at changepoints in both mean and standard deviation:

```{r}
cpt.meanvar(x)
```


## Bayesian changepoint detection

```{r}
library(rstan)

stan(file="changepoint.stan", model_name = "changepoint")
```
